<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neo-Brutalist Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Space Mono", monospace;
        background-color: #f3f4f6;
        background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
        background-size: 20px 20px;
      }

      .hard-shadow {
        box-shadow: 5px 5px 0px 0px #000000;
        transition: all 0.1s ease;
      }

      .hard-shadow:active {
        transform: translate(3px, 3px);
        box-shadow: 2px 2px 0px 0px #000000;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #000;
        border-left: 2px solid #000;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #a855f7;
        border: 2px solid #000;
      }

      .history-overlay {
        transition: transform 0.3s cubic-bezier(0, 1, 0.5, 1);
      }
      .history-hidden {
        transform: translateY(110%);
        visibility: hidden;
      }
      .history-visible {
        transform: translateY(0);
        visibility: visible;
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center p-4 select-none">
    <div
      class="relative w-full max-w-sm bg-[#FFF4DA] border-4 border-black h-[700px] flex flex-col shadow-[10px_10px_0px_0px_rgba(0,0,0,1)]"
    >
      <div
        class="bg-black text-[#00FF41] p-6 border-b-4 border-black flex flex-col relative z-20 h-48 justify-between"
      >
        <div class="flex justify-between items-center">
          <button
            id="btn-open-history"
            class="text-[#00FF41] hover:text-white transition p-1 rounded border border-[#00FF41] hover:bg-[#00FF41] hover:text-black"
          >
            <i class="fa-solid fa-clock-rotate-left text-lg"></i>
          </button>
          <span
            id="memory-indicator"
            class="text-xs font-bold uppercase tracking-widest opacity-50"
            >NO MEMORY</span
          >
        </div>
        <div class="text-right overflow-hidden">
          <div
            id="expression-display"
            class="text-[#00FF41] opacity-70 text-sm font-medium mb-1 min-h-[1.2rem] break-words"
          ></div>
          <div
            id="current-input"
            class="text-5xl font-bold tracking-tighter overflow-hidden text-ellipsis whitespace-nowrap"
          >
            0
          </div>
        </div>
      </div>
      <div class="flex border-b-4 border-black bg-white">
        <button
          data-memory="MC"
          class="flex-1 py-2 text-xs font-bold border-r-2 border-black hover:bg-red-200 transition"
        >
          MC
        </button>
        <button
          data-memory="MR"
          class="flex-1 py-2 text-xs font-bold border-r-2 border-black hover:bg-blue-200 transition"
        >
          MR
        </button>
        <button
          data-memory="M+"
          class="flex-1 py-2 text-xs font-bold border-r-2 border-black hover:bg-green-200 transition"
        >
          M+
        </button>
        <button
          data-memory="M-"
          class="flex-1 py-2 text-xs font-bold hover:bg-yellow-200 transition"
        >
          M-
        </button>
      </div>
      <div
        class="flex-1 bg-[#FFF4DA] p-5 flex flex-col justify-end relative overflow-hidden"
      >
        <div class="grid grid-cols-4 gap-3 h-full">
          <button
            data-action="CE"
            class="hard-shadow bg-[#ff90e8] border-2 border-black text-black font-bold text-lg rounded-none"
          >
            CE
          </button>
          <button
            data-action="C"
            class="hard-shadow bg-[#ff90e8] border-2 border-black text-black font-bold text-lg rounded-none"
          >
            C
          </button>
          <button
            data-action="DELETE"
            class="hard-shadow bg-[#ff90e8] border-2 border-black text-black font-bold text-lg rounded-none"
          >
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <button
            data-operation="÷"
            class="hard-shadow bg-[#ffc900] border-2 border-black text-black font-bold text-2xl rounded-none"
          >
            ÷
          </button>

          <button
            data-number="7"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            7
          </button>
          <button
            data-number="8"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            8
          </button>
          <button
            data-number="9"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            9
          </button>
          <button
            data-operation="×"
            class="hard-shadow bg-[#ffc900] border-2 border-black text-black font-bold text-2xl rounded-none"
          >
            ×
          </button>

          <button
            data-number="4"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            4
          </button>
          <button
            data-number="5"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            5
          </button>
          <button
            data-number="6"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            6
          </button>
          <button
            data-operation="-"
            class="hard-shadow bg-[#ffc900] border-2 border-black text-black font-bold text-2xl rounded-none"
          >
            −
          </button>

          <button
            data-number="1"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            1
          </button>
          <button
            data-number="2"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            2
          </button>
          <button
            data-number="3"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            3
          </button>
          <button
            data-operation="+"
            class="hard-shadow bg-[#ffc900] border-2 border-black text-black font-bold text-2xl rounded-none"
          >
            +
          </button>
          <button
            data-action="NEGATE"
            class="hard-shadow bg-white border-2 border-black text-black text-lg font-bold rounded-none"
          >
            +/-
          </button>
          <button
            data-number="0"
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            0
          </button>
          <button
            data-number="."
            class="hard-shadow bg-white border-2 border-black text-black text-2xl font-bold rounded-none"
          >
            .
          </button>
          <button
            data-action="EQUALS"
            class="hard-shadow bg-black border-2 border-black text-white font-bold text-2xl rounded-none hover:bg-gray-800"
          >
            =
          </button>
        </div>
        <div
          id="history-view"
          class="history-overlay history-hidden absolute inset-0 bg-[#ff90e8] z-30 flex flex-col p-0 border-t-4 border-black"
        >
          <div
            class="flex justify-between items-center p-4 bg-black text-[#ff90e8] border-b-4 border-black"
          >
            <h3 class="font-bold text-xl tracking-tighter">HISTORY</h3>
            <button
              id="btn-close-history"
              class="text-[#ff90e8] hover:text-white border-2 border-[#ff90e8] px-2 py-1 rounded-none bg-black hover:bg-gray-800 transition font-bold"
            >
              X
            </button>
          </div>
          <div
            id="history-list"
            class="flex-1 overflow-y-auto p-4 custom-scrollbar space-y-3 bg-[#FFF4DA]"
          ></div>
          <div class="p-4 bg-[#FFF4DA] border-t-4 border-black">
            <button
              id="clear-history"
              class="hard-shadow w-full py-3 bg-red-500 text-white font-bold border-2 border-black text-sm hover:bg-red-600 uppercase tracking-widest"
            >
              Clear Memory
            </button>
          </div>
        </div>
      </div>
    </div>
    <script>
      class Calculator {
        constructor(expressionDisplay, currentInputDisplay) {
          this.expressionDisplay = expressionDisplay;
          this.currentInputDisplay = currentInputDisplay;
          this.historyListElement = document.getElementById("history-list");
          this.memoryIndicator = document.getElementById("memory-indicator");
          this.currentInput = "0";
          this.expressionParts = [];
          this.memory = 0;
          this.history = [];
          this.isResultDisplayed = false;
        }

        getFormattedNumber(numStr) {
          const num = parseFloat(numStr);
          if (isNaN(num)) return "";
          return num.toLocaleString("en-US", { maximumFractionDigits: 10 });
        }

        updateDisplay() {
          this.currentInputDisplay.innerText = this.getFormattedNumber(
            this.currentInput
          );
          if (this.currentInput.endsWith("."))
            this.currentInputDisplay.innerText += ".";

          const visualExpression = this.expressionParts
            .map((part) => {
              if (part === "/") return "÷";
              if (part === "*") return "×";
              if (part === "-") return "−";
              if (!isNaN(parseFloat(part)) && parseFloat(part) < 0)
                return `(${this.getFormattedNumber(part)})`;
              return this.getFormattedNumber(part) || part;
            })
            .join(" ");
          this.expressionDisplay.innerText = visualExpression;
        }

        appendNumber(number) {
          if (this.isResultDisplayed) {
            this.currentInput = "";
            this.expressionParts = [];
            this.isResultDisplayed = false;
          }
          if (number === "." && this.currentInput.includes(".")) return;
          if (this.currentInput === "0" && number !== ".")
            this.currentInput = number.toString();
          else if (this.currentInput === "-0" && number !== ".")
            this.currentInput = "-" + number.toString();
          else
            this.currentInput =
              this.currentInput.toString() + number.toString();
        }

        negate() {
          if (this.isResultDisplayed) {
            this.currentInput = (parseFloat(this.currentInput) * -1).toString();
            this.isResultDisplayed = false;
            this.expressionParts = [];
          } else {
            if (this.currentInput === "0") return;
            if (this.currentInput.startsWith("-"))
              this.currentInput = this.currentInput.slice(1);
            else this.currentInput = "-" + this.currentInput;
          }
        }

        chooseOperation(operation) {
          if (this.isResultDisplayed) {
            this.isResultDisplayed = false;
            this.expressionParts = [];
          }
          this.expressionParts.push(this.currentInput);
          let opSymbol = operation;
          if (operation === "×") opSymbol = "*";
          if (operation === "÷") opSymbol = "/";
          if (operation === "−") opSymbol = "-";
          this.expressionParts.push(opSymbol);
          this.currentInput = "0";
          this.updateDisplay();
        }

        compute() {
          this.expressionParts.push(this.currentInput);
          const fullExpressionVisual = this.expressionParts
            .map((p) => {
              if (p === "*") return "×";
              if (p === "/") return "÷";
              if (!isNaN(parseFloat(p)) && parseFloat(p) < 0) return `(${p})`;
              return p;
            })
            .join(" ");
          const mathString = this.expressionParts.join(" ");

          try {
            const result = new Function("return " + mathString)();
            if (!isFinite(result) || isNaN(result)) {
              alert("Error");
              this.clear();
              return;
            }
            this.addToHistory(fullExpressionVisual, result);
            this.currentInput = result.toString();
            this.expressionParts = [];
            this.expressionDisplay.innerText = fullExpressionVisual + " =";
            this.isResultDisplayed = true;
          } catch (e) {
            this.clear();
          }
          this.currentInputDisplay.innerText = this.getFormattedNumber(
            this.currentInput
          );
        }

        clear() {
          this.currentInput = "0";
          this.expressionParts = [];
          this.isResultDisplayed = false;
        }
        clearEntry() {
          this.currentInput = "0";
        }
        delete() {
          if (this.isResultDisplayed) return;
          if (
            this.currentInput.length === 1 ||
            (this.currentInput.length === 2 &&
              this.currentInput.startsWith("-"))
          )
            this.currentInput = "0";
          else this.currentInput = this.currentInput.toString().slice(0, -1);
        }

        addToHistory(expression, result) {
          this.history.unshift({ expression, result });
          if (this.history.length > 20) this.history.pop();
          this.renderHistory();
        }

        renderHistory() {
          this.historyListElement.innerHTML = "";
          if (this.history.length === 0) {
            this.historyListElement.innerHTML =
              '<div class="text-black text-center mt-10 font-bold opacity-50">EMPTY_LOG</div>';
            return;
          }
          this.history.forEach((item) => {
            const div = document.createElement("div");
            div.className =
              "bg-white p-3 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] cursor-pointer hover:translate-x-1 hover:translate-y-1 hover:shadow-none transition-all";
            div.innerHTML = `
                        <div class="text-xs text-gray-500 mb-1 text-right font-bold">${
                          item.expression
                        } =</div>
                        <div class="text-xl font-bold text-black text-right">${this.getFormattedNumber(
                          item.result
                        )}</div>
                    `;
            div.onclick = () => {
              this.currentInput = item.result.toString();
              this.expressionParts = [];
              this.isResultDisplayed = true;
              this.updateDisplay();
              closeHistoryView();
            };
            this.historyListElement.appendChild(div);
          });
        }

        clearHistory() {
          this.history = [];
          this.renderHistory();
        }

        handleMemory(action) {
          const current = parseFloat(this.currentInput);
          if (isNaN(current)) return;
          if (action === "MC") this.memory = 0;
          else if (action === "M+") this.memory += current;
          else if (action === "M-") this.memory -= current;
          else if (action === "MR") {
            this.currentInput = this.memory.toString();
            this.isResultDisplayed = true;
          }

          if (this.memory !== 0) {
            this.memoryIndicator.innerText = `MEM: ${this.getFormattedNumber(
              this.memory
            )}`;
            this.memoryIndicator.style.opacity = "1";
            this.memoryIndicator.classList.add("text-[#00FF41]");
          } else {
            this.memoryIndicator.innerText = "NO MEMORY";
            this.memoryIndicator.style.opacity = "0.5";
            this.memoryIndicator.classList.remove("text-[#00FF41]");
          }
          this.updateDisplay();
        }
      }

      const calc = new Calculator(
        document.getElementById("expression-display"),
        document.getElementById("current-input")
      );

      document.querySelectorAll("[data-number]").forEach((btn) =>
        btn.addEventListener("click", () => {
          calc.appendNumber(btn.innerText);
          calc.updateDisplay();
        })
      );
      document.querySelectorAll("[data-operation]").forEach((btn) =>
        btn.addEventListener("click", () => {
          calc.chooseOperation(btn.innerText);
          calc.updateDisplay();
        })
      );
      document.querySelectorAll("[data-memory]").forEach((btn) =>
        btn.addEventListener("click", () => {
          calc.handleMemory(btn.dataset.memory);
        })
      );
      document
        .querySelector('[data-action="EQUALS"]')
        .addEventListener("click", () => calc.compute());
      document
        .querySelector('[data-action="C"]')
        .addEventListener("click", () => {
          calc.clear();
          calc.updateDisplay();
        });
      document
        .querySelector('[data-action="CE"]')
        .addEventListener("click", () => {
          calc.clearEntry();
          calc.updateDisplay();
        });
      document
        .querySelector('[data-action="DELETE"]')
        .addEventListener("click", () => {
          calc.delete();
          calc.updateDisplay();
        });
      document
        .querySelector('[data-action="NEGATE"]')
        .addEventListener("click", () => {
          calc.negate();
          calc.updateDisplay();
        });

      const historyView = document.getElementById("history-view");
      function openHistoryView() {
        historyView.classList.remove("history-hidden");
        historyView.classList.add("history-visible");
      }
      function closeHistoryView() {
        historyView.classList.remove("history-visible");
        historyView.classList.add("history-hidden");
      }

      document
        .getElementById("btn-open-history")
        .addEventListener("click", openHistoryView);
      document
        .getElementById("btn-close-history")
        .addEventListener("click", closeHistoryView);
      document
        .getElementById("clear-history")
        .addEventListener("click", () => calc.clearHistory());

      document.addEventListener("keydown", (e) => {
        if ((e.key >= "0" && e.key <= "9") || e.key === ".") {
          calc.appendNumber(e.key);
          calc.updateDisplay();
        }
        if (e.key === "=" || e.key === "Enter") {
          e.preventDefault();
          calc.compute();
        }
        if (e.key === "Backspace") {
          calc.delete();
          calc.updateDisplay();
        }
        if (e.key === "Escape") {
          if (historyView.classList.contains("history-visible"))
            closeHistoryView();
          else {
            calc.clear();
            calc.updateDisplay();
          }
        }
        if (["+", "-", "*", "/"].includes(e.key)) {
          const map = { "*": "×", "/": "÷", "-": "-" };
          calc.chooseOperation(map[e.key] || e.key);
        }
        if (e.key === "n" || e.key === "_") {
          calc.negate();
          calc.updateDisplay();
        }
      });
    </script>
  </body>
</html>
